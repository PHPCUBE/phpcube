{% extends "layout.html" %}


{% set page = 'step3' %}


{% block content %}
<style>
#scene {
  background-size: cover;
}
.compare-row {
  display: none;
}
.ready {
  display: none;
}
</style>
<script>
$(function () {

  var materials = $('.material')
    , materialBlock = $('#material-block')
    , materialUsing = Array ()
    , scene = $('#scene')
    , compare = $('.compare-row')
    ;

  $(window).resize (function () {
    scene.parent ().css ('height', $(this).height () - 60);
  });

  $('.material').click (function () {

    materials.find ('span').removeClass ('selected').addClass ('check')
      .end ().filter ($(this)).find ('span').removeClass ('check').addClass ('selected');

    id = $(this).data ('material');

    scene.css ('background-image', 'url("images/compose-' + '{{ type }}' + '-' + id + '.jpg")');

    return false;
  });


  $('#add-material').click (function () {

    if ($('.compare-body li').size () >= 4)
      return false;

    var m = materials.find ('span.selected').parent ().data ('material');

    if (materialUsing[m] && materialUsing[m] == 1)
      return false;

    $('.compare-body ul').prepend ('<li data-material="' + m + '"><span class="del-material"></span><img src="' + materials.find ('span.selected').next ('img').attr ('src') + '" width="140" height="140" class="img-responsive"></li>');

    materialsHandler ();

  });


  $('.compare-row').on ('click', '.del-material', function () {
    $(this).parent ().remove ();
    materialsHandler ();
  });


  function materialsHandler () {

    var size = $('.compare-body li').size ();

    if (size < 2) {

      $('.not-ready').show ();
      $('.ready').hide ();

      if (size == 0)
        compare.hide ();

      else
        compare.show ();
    }

    else {

      compare.show ();

      $('.not-ready').hide ();
      $('.ready').show ();      
    }

    materialUsing = Array ();
    materialBlock.empty ();

    $('.compare-body ul li').each (function () {
      var m = $(this).data ('material');
      console.log ('in');
      materialUsing[m] = 1;
      materialBlock.append ('<input type="hidden" name="material[]" value="' + m + '" />')
    });
  }

  $('.scene-select').click (function () {
    $('#scene-value').val ($(this).data ('scene')).parent ().submit ();
  });

  $(window).trigger ('resize');
  materials.eq (0).trigger ('click');

});
</script>

<div class="container-fluid">

  <div class="row" >
    
        <!--場景_開始-->   
      <div id="scene" class="col-lg-10 col-md-10 pa0" style="height: 100%;">
          
            <div class="compare-row">
              <div class="compare-head">比較清單</div>
                <div class="compare-body">
                  <ul>
                  </ul>
                </div>
                <div class="compare-footer not-ready">
                  <span>至少加入2個</span>
                </div>
                <div class="compare-footer ready">
                  <button data-toggle="modal" data-target="#myModal">開始比較</button>
                </div>
            </div>
            
          <div class="add-compare-btn"><button id="add-material" class="btn btn-success btn-lg">加入比較</button></div>
            
        </div>
        <!--場景_結束-->   
        
        <!--側邊欄_開始-->
      <div class="col-lg-2 col-md-2 pa0">
        
          <div class="row">
            
              <div class="col-lg-12 col-md-12 sidebar cloth">
                
                    <div class="row pl25 pr25">
                    
                        <form>
                          <div class="form-group mt10 mb10">
                            <input type="text" class="form-control" placeholder="請輸入貨號查詢">
                          </div>
                            <label><input type="checkbox">防焰</label>
                            <label><input type="checkbox">遮光</label>
                            <label><input type="checkbox">透光</label>
                        </form>
                    </div>
                    <hr style="margin:0;">
                    <h4 class="pl10">請挑選窗簾布料</h4>
                    <ul class="row pl20 pr20">
                        <li class="col-lg-3 col-md-6 pa0"><a class="material" data-material="1" href="#"><span class="check"></span><img src="images/demo-6.jpg" width="140" height="140" class="img-responsive"></a></li>
                        <li class="col-lg-3 col-md-6 pa0"><a class="material" data-material="2" href="#"><span class="check"></span><img src="images/demo-7.jpg" width="140" height="140" class="img-responsive"></a></li>
                        <li class="col-lg-3 col-md-6 pa0"><a class="material" data-material="3" href="#"><span class="check"></span><img src="images/demo-8.jpg" width="140" height="140" class="img-responsive"></a></li>
                        <li class="col-lg-3 col-md-6 pa0"><a class="material" data-material="4" href="#"><span class="check"></span><img src="images/demo-9.jpg" width="140" height="140" class="img-responsive"></a></li>
                    
                    </ul>   
                                 
                </div>
                
            </div>
            
        </div>
        <!--側邊欄_結束-->
    
  </div>

</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">選擇安裝位置</h4>
      </div>
      <div class="modal-body">
        <div class="room">
            <ul>
                <li><a class="scene-select" data-scene="1" href="#">客廳</a></li>
                <li><a class="scene-select" data-scene="2" href="#">主臥</a></li>
                <li><a class="scene-select" data-scene="3" href="#">次臥</a></li>
                <li><a class="scene-select" data-scene="4" href="#">嬰兒房</a></li>
                <li><a class="scene-select" data-scene="5" href="#">書房</a></li>
            </ul>
        </div>
        <form action="{{ url('step4') }}">
          <input type="hidden" name="type" value="{{ type }}" />
          <input type="hidden" name="width" value="{{ width }}" />
          <input type="hidden" name="height" value="{{ height }}" />
          <input type="hidden" name="scene" id="scene-value" value="" />
          <div id="material-block">
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
